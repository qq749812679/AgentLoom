## 大模型交互细节（设计与实践）

### 通用原则
- 明确意图：将用户“主题/情绪/场景/用途/时长/设备”结构化
- 幂等与可复现：显式 seed、记录参数、缓存字节级结果
- 可控与安全：限制负面/侵权 prompt，注入安全提示与风格先验
- 音视频推理超时与重试：指数退避、降级到本地合成

### 图片（SDXL/Flux 等）
- Prompt 结构：
  - 指令：场景主题、氛围、光影、色彩关键词
  - 设备/用途：横幅/海报/移动端背景（决定比例与留白）
  - 风格：插画/写实/赛博/国潮；LoRA 标签
  - 安全前缀（避免裸露、仇恨等）
- 关键参数：`width/height/seed/guidance/steps/scheduler/neg_prompt`，风格模板
- 交互：
  - 预设模板一键生成 + 高级参数折叠面板
  - 变体按钮（seed 邻域），保留历史与对比
  - 失败自动回退到合成模式

### 音乐（MusicGen/AudioLDM 等）
- Prompt 结构：主题+情绪+节奏+乐器清单+用途时长
- 关键参数：`duration/top_k/top_p/temperature/cfg_scale`、采样率与输出格式
- 交互：
  - 预设风格：睡眠/派对/冥想/圣诞…
  - 时长与循环点；波形预览与响度归一
  - 失败回退到合成旋律（当前实现）

### 语音（Whisper/Edge STT, Edge TTS）
- STT：语言提示、静音裁剪、分段时间戳；结果置信度用于二次确认
- TTS：声音角色、语速/语调、停顿 SSML；播报状态与重播

### 灯光（Hue/Yeelight/WLED/DMX）
- 映射策略：图像/音乐特征→色相/亮度/过渡；节拍对齐
- 设备能力协商：最小过渡时间、色域、通道映射
- 交互：模拟器预览→实灯发送；安全开关、速停

### 性能与缓存
- 请求签名缓存（字节缓存），LRU 清理；跨会话复用
- 任务日志 JSONL（请求/响应元数据），便于追责与重现

### 失败与降级
- 网络错误：重试 N 次；切换到备用后端
- 模型超时：降级到本地合成器；提示用户




